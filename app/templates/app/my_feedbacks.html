{% extends "app/layout.html" %}

{% block title %}Мои отзывы - Avec Plaisir{% endblock %}

{% block content %}
<div class="my-feedbacks-page">
    <h1>👤 Мои отзывы</h1>

    {% if user.is_authenticated %}
    <!-- Личная информация -->
    <div class="personal-info">
        <h3>📋 Ваши данные</h3>
        <div class="info-grid">
            <div class="info-item">
                <strong>Имя пользователя:</strong>
                <span>{{ user.username }}</span>
            </div>
            <div class="info-item">
                <strong>Email:</strong>
                <span>{{ user.email }}</span>
            </div>
            <div class="info-item">
                <strong>Дата регистрации:</strong>
                <span>{{ user.date_joined|date:"d.m.Y H:i" }}</span>
            </div>
            <div class="info-item">
                <strong>Статус:</strong>
                <span class="status-active">Активный</span>
            </div>
        </div>
    </div>

    <!-- Мои отзывы -->
    <div class="my-feedbacks-section">
        <h3>📝 История моих отзывов ({{ total_feedbacks }})</h3>

        {% if feedbacks %}
        <div class="feedbacks-container">
            {% for feedback in feedbacks %}
            <div class="my-feedback-item">
                <div class="feedback-summary">
                    <div class="feedback-date-rating">
                        <span class="date">{{ feedback.created_at|date:"d.m.Y H:i" }}</span>
                        <span class="rating">{{ feedback.overall_rating }}</span>
                        <span class="score">{{ feedback.recommendation }}/10</span>
                    </div>

                    <div class="feedback-details">
                        <div class="detail">
                            <strong>Оценка:</strong> {{ feedback.overall_rating }}
                        </div>
                        <div class="detail">
                            <strong>Рекомендация:</strong> {{ feedback.recommendation }}/10
                        </div>
                        {% if feedback.suggestions %}
                        <div class="detail">
                            <strong>Предложения:</strong>
                            <div class="suggestion">{{ feedback.suggestions|truncatechars:150 }}</div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-feedbacks-message">
            <div class="message-content">
                <div class="icon">💬</div>
                <h4>У вас пока нет отзывов</h4>
                <p>Оставьте свой первый отзыв о нашем сайте!</p>
                <a href="{% url 'feedback' %}" class="btn btn-primary">Оставить отзыв</a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Навигация -->
    <div class="action-buttons">
        <a href="{% url 'feedback' %}" class="btn btn-primary">📝 Новый отзыв</a>
        <a href="{% url 'feedback_list' %}" class="btn btn-default">📊 Все отзывы</a>
        <a href="{% url 'home' %}" class="btn btn-default">← На главную</a>
    </div>

    {% else %}
    <div class="auth-required">
        <div class="auth-message">
            <h3>🔒 Требуется авторизация</h3>
            <p>Для просмотра ваших отзывов необходимо войти в систему.</p>
            <div class="auth-buttons">
                <a href="{% url 'login' %}" class="btn btn-primary">Войти</a>
                <a href="{% url 'register' %}" class="btn btn-default">Регистрация</a>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
    .my-feedbacks-page {
        padding: 20px 0;
    }

    .personal-info {
        background: #222;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
        border: 1px solid #333;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .info-item {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

        .info-item strong {
            color: #8B0000;
            font-size: 0.9em;
        }

        .info-item span {
            color: #ddd;
            font-size: 1.1em;
        }

    .status-active {
        color: #28a745;
        font-weight: bold;
    }

    .my-feedbacks-section {
        background: #222;
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 25px;
        border: 1px solid #333;
    }

    .feedbacks-container {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 20px;
    }

    .my-feedback-item {
        background: #2a2a2a;
        padding: 15px;
        border-radius: 6px;
        border: 1px solid #444;
    }

    .feedback-summary {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .feedback-date-rating {
        display: flex;
        align-items: center;
        gap: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #333;
    }

    .date {
        color: #aaa;
        font-size: 0.9em;
    }

    .rating {
        color: #ffd700;
        font-weight: bold;
    }

    .score {
        color: #8B0000;
        font-weight: bold;
        background: #333;
        padding: 3px 8px;
        border-radius: 4px;
    }

    .feedback-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
    }

    .detail {
        color: #ddd;
    }

        .detail strong {
            color: #8B0000;
        }

    .suggestion {
        background: #333;
        padding: 8px;
        border-radius: 4px;
        margin-top: 5px;
        color: #aaa;
        font-size: 0.9em;
    }

    .no-feedbacks-message {
        text-align: center;
        padding: 40px 20px;
    }

    .message-content {
        max-width: 300px;
        margin: 0 auto;
    }

        .message-content .icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .message-content h4 {
            color: #8B0000;
            margin-bottom: 10px;
        }

        .message-content p {
            color: #aaa;
            margin-bottom: 20px;
        }

    .action-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-top: 20px;
    }

    .auth-required {
        text-align: center;
        padding: 40px 20px;
    }

    .auth-message {
        max-width: 400px;
        margin: 0 auto;
        background: #222;
        padding: 30px;
        border-radius: 8px;
        border: 1px solid #333;
    }

        .auth-message h3 {
            color: #8B0000;
            margin-bottom: 15px;
        }

        .auth-message p {
            color: #ddd;
            margin-bottom: 20px;
        }

    .auth-buttons {
        display: flex;
        gap: 10px;
        justify-content: center;
    }

    @media (max-width: 768px) {
        .info-grid {
            grid-template-columns: 1fr;
        }

        .feedback-details {
            grid-template-columns: 1fr;
        }

        .action-buttons,
        .auth-buttons {
            flex-direction: column;
            align-items: center;
        }
    }
</style>
{% endblock %}