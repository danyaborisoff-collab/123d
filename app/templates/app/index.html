{% extends "app/layout.html" %}
{% load static %}

{% block title %}Главная - Avec Plaisir{% endblock %}

{% block content %}

<!-- Наша собственная карусель -->
<div class="carousel-container" style="max-width: 1200px; margin: 0 auto 40px; position: relative; overflow: hidden; border-radius: 10px; border: 2px solid #8B0000; box-shadow: 0 8px 30px rgba(139, 0, 0, 0.3); background: #000;">
    <div class="carousel-track" style="display: flex; transition: transform 0.5s ease-in-out; height: 400px;">
        <!-- Слайд 1 -->
        <div class="carousel-slide active" style="min-width: 100%; position: relative;">
            <img src="{% static 'app/images/slide1.png' %}" alt="Сувениры" 
                 style="width: 100%; height: 100%; object-fit: cover;">
            <div class="carousel-caption" style="position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 15px; border-radius: 5px; text-align: center; min-width: 300px;">
                <h3 style="margin: 0 0 10px 0; color: white; font-weight: bold;">Уникальные сувениры</h3>
                <p style="margin: 0;">Эксклюзивные работы мастеров со всей России</p>
            </div>
        </div>
        
        <!-- Слайд 2 -->
        <div class="carousel-slide" style="min-width: 100%; position: relative;">
            <img src="{% static 'app/images/slide2.png' %}" alt="Доставка" 
                 style="width: 100%; height: 100%; object-fit: cover;">
            <div class="carousel-caption" style="position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 15px; border-radius: 5px; text-align: center; min-width: 300px;">
                <h3 style="margin: 0 0 10px 0; color: white; font-weight: bold;">Быстрая доставка</h3>
                <p style="margin: 0;">По всей России за 3-7 рабочих дней</p>
            </div>
        </div>
        
        <!-- Слайд 3 -->
        <div class="carousel-slide" style="min-width: 100%; position: relative;">
            <img src="{% static 'app/images/slide3.png' %}" alt="Качество" 
                 style="width: 100%; height: 100%; object-fit: cover;">
            <div class="carousel-caption" style="position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 15px; border-radius: 5px; text-align: center; min-width: 300px;">
                <h3 style="margin: 0 0 10px 0; color: white; font-weight: bold;">Гарантия качества</h3>
                <p style="margin: 0;">Строгий контроль перед отправкой</p>
            </div>
        </div>
    </div>
    
    <!-- Индикаторы -->
    <div class="carousel-indicators" style="position: absolute; bottom: 20px; left: 0; right: 0; display: flex; justify-content: center; gap: 10px; z-index: 10;">
        <button class="indicator active" data-slide="0" style="width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; background: #8B0000; cursor: pointer; transition: background 0.3s; padding: 0;"></button>
        <button class="indicator" data-slide="1" style="width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; background: #8B0000; cursor: pointer; transition: background 0.3s; padding: 0;"></button>
        <button class="indicator" data-slide="2" style="width: 12px; height: 12px; border-radius: 50%; border: 2px solid white; background: #8B0000; cursor: pointer; transition: background 0.3s; padding: 0;"></button>
    </div>
    
    <!-- Кнопки навигации -->
    <button class="carousel-btn prev" style="position: absolute; left: 20px; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; border-radius: 50%; background: #8B0000; color: white; border: none; font-size: 24px; cursor: pointer; z-index: 10; transition: all 0.3s; display: flex; align-items: center; justify-content: center;">‹</button>
    <button class="carousel-btn next" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); width: 50px; height: 50px; border-radius: 50%; background: #8B0000; color: white; border: none; font-size: 24px; cursor: pointer; z-index: 10; transition: all 0.3s; display: flex; align-items: center; justify-content: center;">›</button>
</div>

<div class="jumbotron" style="background: linear-gradient(to right, #8B0000, #B22222) !important; color: white !important; border-radius: 4px; padding: 20px !important; margin-bottom: 55px; text-align: center; border: 1px solid #8B0000;">
    <h1 style="color: white !important; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
        <img src="{% static 'app/images/logo.png' %}" alt="Avec Plaisir" style="height: 60px; margin-bottom: 15px;">
    </h1>
    <p class="lead" style="font-weight: bold; color: white !important;">Добро пожаловать в наш сувенирный магазин! Уникальные сувениры и подарки, которые дарят радость.</p>
    {% if not user.is_authenticated %}
    <p><a href="{% url 'register' %}" class="btn btn-primary btn-lg">Зарегистрироваться →</a></p>
    {% else %}
    <p><a href="{% url 'feedback' %}" class="btn btn-primary btn-lg">Оставить отзыв →</a></p>
    {% endif %}
</div>

<!-- Карточки -->
<div class="row">
    <div class="col-md-4">
        <div class="feature-card" style="background: linear-gradient(135deg, #660000, #990000); padding: 25px; border-radius: 10px; color: white; height: 100%; box-shadow: 0 4px 15px rgba(139, 0, 0, 0.2); transition: all 0.3s ease; border: 1px solid #660000;">
            <h2 style="color: #ffffff; margin-top: 0; font-weight: bold; border-bottom: none; padding-bottom: 0;">Уникальные сувениры</h2>
            <p style="font-size: 16px; line-height: 1.5;">Каждый наш товар — это эксклюзивная работа мастеров со всей России.</p>
            {% if user.is_authenticated %}
            <p><a class="btn btn-default" href="{% url 'catalog' %}" style="...">Смотреть коллекцию &raquo;</a></p>
            {% else %}
            <p><a class="btn btn-default" href="{% url 'register' %}" style="background-color: white; color: #660000; border: none; font-weight: bold; padding: 10px 20px; border-radius: 5px;">Зарегистрируйтесь для доступа &raquo;</a></p>
            {% endif %}
        </div>
    </div>

    <div class="col-md-4">
        <div class="feature-card" style="background: linear-gradient(135deg, #660000, #990000); padding: 25px; border-radius: 10px; color: white; height: 100%; box-shadow: 0 4px 15px rgba(139, 0, 0, 0.2); transition: all 0.3s ease; border: 1px solid #660000;">
            <h2 style="color: #ffffff; margin-top: 0; font-weight: bold; border-bottom: none; padding-bottom: 0;">Быстрая доставка</h2>
            <p style="font-size: 16px; line-height: 1.5;">Доставляем заказы по всей России за 3-7 рабочих дней.</p>
            <p><a class="btn btn-default" href="{% url 'about' %}" style="background-color: white; color: #660000; border: none; font-weight: bold; padding: 10px 20px; border-radius: 5px;">Подробнее &raquo;</a></p>
        </div>
    </div>

    <div class="col-md-4">
        <div class="feature-card" style="background: linear-gradient(135deg, #660000, #990000); padding: 25px; border-radius: 10px; color: white; height: 100%; box-shadow: 0 4px 15px rgba(139, 0, 0, 0.2); transition: all 0.3s ease; border: 1px solid #660000;">
            <h2 style="color: #ffffff; margin-top: 0; font-weight: bold; border-bottom: none; padding-bottom: 0;">Гарантия качества</h2>
            <p style="font-size: 16px; line-height: 1.5;">Все товары проходят строгий контроль перед отправкой.</p>
            <p><a class="btn btn-default" href="{% url 'contact' %}" style="background-color: white; color: #660000; border: none; font-weight: bold; padding: 10px 20px; border-radius: 5px;">Написать нам &raquo;</a></p>
        </div>
    </div>
</div>

{% if not user.is_authenticated %}
<div class="row" style="margin-top: 40px;">
    <div class="col-md-12">
        <div class="panel panel-default" style="background: linear-gradient(135deg, #8B0000, #A52A2A); border: none; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 20px rgba(139, 0, 0, 0.4);">
            <div class="panel-heading" style="background: rgba(0,0,0,0.2); border-bottom: 1px solid rgba(255,255,255,0.1); padding: 20px;">
                <h3 class="panel-title" style="color: white; border-bottom: none; padding-bottom: 0; margin: 0; text-align: center; font-weight: bold;">Почему стоит зарегистрироваться?</h3>
            </div>
            <div class="panel-body" style="background: transparent; color: white; padding: 30px;">
                <div class="row">
                    <div class="col-md-3 text-center" style="margin-bottom: 20px;">
                        <div style="font-size: 40px; margin-bottom: 15px; color: white;">🚚</div>
                        <p style="font-size: 16px;">Быстрое оформление заказов</p>
                    </div>
                    <div class="col-md-3 text-center" style="margin-bottom: 20px;">
                        <div style="font-size: 40px; margin-bottom: 15px; color: white;">💬</div>
                        <p style="font-size: 16px;">Возможность оставлять отзывы</p>
                    </div>
                    <div class="col-md-3 text-center" style="margin-bottom: 20px;">
                        <div style="font-size: 40px; margin-bottom: 15px; color: white;">🎁</div>
                        <p style="font-size: 16px;">Специальные предложения</p>
                    </div>
                    <div class="col-md-3 text-center" style="margin-bottom: 20px;">
                        <div style="font-size: 40px; margin-bottom: 15px; color: white;">📋</div>
                        <p style="font-size: 16px;">История ваших покупок</p>
                    </div>
                </div>
                <div class="text-center" style="margin-top: 30px;">
                    <a href="{% url 'register' %}" class="btn btn-primary btn-lg" style="background-color: white; color: #8B0000; border: none; font-weight: bold; padding: 15px 40px; border-radius: 5px;">Зарегистрироваться сейчас</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

<style>
    /* Стили для карусели */
    .carousel-container {
        user-select: none;
    }
    
    .carousel-track {
        will-change: transform;
    }
    
    .carousel-slide {
        flex-shrink: 0;
    }
    
    .carousel-btn {
        opacity: 0.8;
    }
    
    .carousel-btn:hover {
        opacity: 1;
        background: #A52A2A !important;
        transform: translateY(-50%) scale(1.1) !important;
    }
    
    .indicator.active {
        background: white !important;
    }
    
    /* Эффекты для карточек */
    .feature-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(139, 0, 0, 0.4) !important;
    }
    
    /* Адаптивность */
    @media (max-width: 768px) {
        .carousel-container {
            margin: 0 15px 30px;
        }
        
        .carousel-track {
            height: 300px !important;
        }
        
        .carousel-btn {
            width: 40px !important;
            height: 40px !important;
            font-size: 20px !important;
            left: 10px !important;
            right: 10px !important;
        }
        
        .carousel-caption {
            bottom: 20px !important;
            padding: 10px !important;
            min-width: 250px !important;
        }
        
        .carousel-caption h3 {
            font-size: 1.2rem !important;
            margin-bottom: 5px !important;
        }
        
        .carousel-caption p {
            font-size: 0.9rem !important;
        }
        
        .feature-card {
            margin-bottom: 20px;
        }
    }
    
    @media (max-width: 576px) {
        .carousel-track {
            height: 250px !important;
        }
        
        .carousel-btn {
            width: 35px !important;
            height: 35px !important;
            font-size: 18px !important;
        }
        
        .carousel-caption {
            min-width: 200px !important;
            padding: 8px !important;
        }
        
        .carousel-caption h3 {
            font-size: 1rem !important;
        }
        
        .carousel-caption p {
            font-size: 0.8rem !important;
        }
    }
</style>

<script>
    // Наша собственная карусель на чистом JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Инициализация карусели...');
        
        const carouselTrack = document.querySelector('.carousel-track');
        const slides = document.querySelectorAll('.carousel-slide');
        const prevBtn = document.querySelector('.carousel-btn.prev');
        const nextBtn = document.querySelector('.carousel-btn.next');
        const indicators = document.querySelectorAll('.indicator');
        
        if (!carouselTrack || slides.length === 0) {
            console.error('Элементы карусели не найдены');
            return;
        }
        
        let currentSlide = 0;
        const totalSlides = slides.length;
        let autoSlideInterval;
        
        console.log('Найдено слайдов:', totalSlides);
        
        // Функция перехода к слайду
        function goToSlide(slideIndex) {
            if (slideIndex < 0) slideIndex = totalSlides - 1;
            if (slideIndex >= totalSlides) slideIndex = 0;
            
            // Обновляем текущий слайд
            currentSlide = slideIndex;
            
            // Перемещаем трек
            carouselTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            // Обновляем активные классы у слайдов
            slides.forEach((slide, index) => {
                if (index === currentSlide) {
                    slide.classList.add('active');
                } else {
                    slide.classList.remove('active');
                }
            });
            
            // Обновляем индикаторы
            indicators.forEach((indicator, index) => {
                if (index === currentSlide) {
                    indicator.classList.add('active');
                    indicator.style.background = 'white';
                } else {
                    indicator.classList.remove('active');
                    indicator.style.background = '#8B0000';
                }
            });
            
            console.log('Текущий слайд:', currentSlide + 1);
        }
        
        // Следующий слайд
        function nextSlide() {
            console.log('Переключение на следующий слайд');
            goToSlide(currentSlide + 1);
        }
        
        // Предыдущий слайд
        function prevSlide() {
            console.log('Переключение на предыдущий слайд');
            goToSlide(currentSlide - 1);
        }
        
        // Старт автоматического переключения
        function startAutoSlide() {
            console.log('Запуск автоматического переключения');
            autoSlideInterval = setInterval(nextSlide, 5000);
        }
        
        // Остановка автоматического переключения
        function stopAutoSlide() {
            console.log('Остановка автоматического переключения');
            clearInterval(autoSlideInterval);
        }
        
        // Инициализация карусели
        function initCarousel() {
            console.log('Инициализация карусели');
            
            // Проверяем, что все изображения загружены
            slides.forEach((slide, index) => {
                const img = slide.querySelector('img');
                if (img) {
                    img.onload = function() {
                        console.log('Изображение', index + 1, 'загружено');
                    };
                    img.onerror = function() {
                        console.error('Ошибка загрузки изображения', index + 1);
                    };
                }
            });
            
            // Обработчики для кнопок
            prevBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Нажата кнопка "назад"');
                prevSlide();
                stopAutoSlide();
                setTimeout(startAutoSlide, 10000);
            });
            
            nextBtn.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('Нажата кнопка "вперед"');
                nextSlide();
                stopAutoSlide();
                setTimeout(startAutoSlide, 10000);
            });
            
            // Обработчики для индикаторов
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Нажат индикатор', index);
                    goToSlide(index);
                    stopAutoSlide();
                    setTimeout(startAutoSlide, 10000);
                });
            });
            
            // Пауза при наведении
            const carouselContainer = document.querySelector('.carousel-container');
            carouselContainer.addEventListener('mouseenter', stopAutoSlide);
            carouselContainer.addEventListener('mouseleave', startAutoSlide);
            
            // Убедимся, что начальное положение правильное
            carouselTrack.style.transform = 'translateX(0%)';
            
            // Запускаем автоматическое переключение
            startAutoSlide();
            
            console.log('Карусель успешно инициализирована');
        }
        
        // Даем время на загрузку страницы и запускаем инициализацию
        setTimeout(initCarousel, 100);
    });
</script>
{% endblock %}